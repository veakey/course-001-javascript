<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Le Pendu</title>
  <link rel="stylesheet" href="../shared/css/glassui.css">
  <link rel="stylesheet" href="../shared/css/common.css">
  <link rel="stylesheet" href="../shared/css/validation.css">
  <link rel="stylesheet" href="css/style.css">
  <!-- CodeMirror -->
  <link rel="stylesheet" href="../shared/css/codemirror/codemirror.css">
  <link rel="stylesheet" href="../shared/css/codemirror/theme/monokai.css">
  <script src="../shared/js/codemirror/codemirror.js"></script>
  <script src="../shared/js/codemirror/mode/javascript.js"></script>
</head>
<body>
  <div class="container">
    <div class="terminal-panel glass-panel">
      <div class="terminal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h2 style="margin: 0; color: var(--text-primary);">Terminal</h2>
        <button id="code-expand-btn" class="glass-button" type="button" title="Agrandir le panneau code">Agrandir</button>
      </div>
      <div id="code-editor"></div>
      <button id="execute-btn" class="glass-button primary">Ex√©cuter</button>
      <div id="output" class="glass-panel" style="margin-top: 16px; padding: 16px;"></div>
      <div id="validation-panel" class="validation-panel glass-panel" style="display: none;">
        <h3 style="margin-bottom: 12px;">Tests de validation</h3>
        <div id="validation-status" class="validation-status"></div>
        <ul id="validation-tests" class="validation-tests"></ul>
      </div>
    </div>
    <div class="game-panel glass-panel">
      <h2 style="margin-bottom: 16px; color: var(--text-primary);">Le Pendu</h2>
      <canvas id="game-canvas" width="400" height="500"></canvas>
      <div id="word-display" style="text-align: center; font-size: 32px; letter-spacing: 8px; margin: 16px 0; color: var(--text-primary); font-weight: bold;"></div>
      <div id="game-message" style="text-align: center; font-size: 24px; font-weight: bold; margin: 16px 0; min-height: 32px; display: none;"></div>
      <div id="letters-used" style="text-align: center; color: var(--text-secondary); margin-top: 16px;"></div>
      <div id="word-selection-container" style="margin-top: 16px; display: flex; gap: 8px; align-items: center; justify-content: center; flex-wrap: wrap;">
        <input type="text" id="word-input" class="glass-input" placeholder="Choisissez un mot √† faire deviner..." style="width: 250px; text-align: center; text-transform: uppercase;">
        <button id="start-game-btn" class="glass-button primary">D√©marrer</button>
      </div>
      <div id="game-controls-container" style="margin-top: 16px; display: none; gap: 8px; align-items: center; justify-content: center; flex-wrap: wrap;">
        <div style="display: flex; gap: 8px; align-items: center; justify-content: center;">
          <input type="text" id="letter-input" class="glass-input" placeholder="Entrez une lettre..." style="width: 200px; text-align: center; text-transform: uppercase;" maxlength="1">
          <button id="submit-letter" class="glass-button primary">Proposer</button>
        </div>
        <button id="new-game-btn" class="glass-button" style="margin-top: 8px;">Nouvelle partie</button>
      </div>
    </div>
  </div>
  <script type="text/plain" id="game-code">
// Le Pendu
// Devinez le mot lettre par lettre

const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const wordDisplay = document.getElementById('word-display');
const lettersUsedDiv = document.getElementById('letters-used');
const letterInput = document.getElementById('letter-input');
const submitLetterBtn = document.getElementById('submit-letter');
const gameMessage = document.getElementById('game-message');
const wordSelectionContainer = document.getElementById('word-selection-container');
const gameControlsContainer = document.getElementById('game-controls-container');
const wordInput = document.getElementById('word-input');
const startGameBtn = document.getElementById('start-game-btn');
const newGameBtn = document.getElementById('new-game-btn');

// √âtat du jeu
let motSecret = '';
let motAffiche = '';
let lettresUtilisees = [];
let erreurs = 0;
const maxErreurs = 10;
let partieEnCours = false;

// Liste de mots
const mots = ['JAVASCRIPT', 'PROGRAMMATION', 'DEVELOPPEUR', 'ALGORITHME', 'FONCTION', 'VARIABLE', 'BOUCLE', 'TABLEAU'];

// Fonction pour afficher un message de feedback
function afficherMessage(message, type = 'info') {
  if (gameMessage) {
    gameMessage.textContent = message;
    gameMessage.style.display = 'block';
    
    // Couleurs selon le type
    if (type === 'victoire') {
      gameMessage.style.color = '#4ade80'; // Vert
    } else if (type === 'defaite') {
      gameMessage.style.color = '#f87171'; // Rouge
    } else {
      gameMessage.style.color = 'var(--text-primary)';
    }
  }
}

// Fonction pour cacher le message
function cacherMessage() {
  if (gameMessage) {
    gameMessage.style.display = 'none';
    gameMessage.textContent = '';
  }
}

// Fonction pour afficher/masquer les contr√¥les
function afficherControlesJeu() {
  if (wordSelectionContainer) wordSelectionContainer.style.display = 'none';
  if (gameControlsContainer) gameControlsContainer.style.display = 'flex';
}

function afficherSelectionMot() {
  if (wordSelectionContainer) wordSelectionContainer.style.display = 'flex';
  if (gameControlsContainer) gameControlsContainer.style.display = 'none';
  if (wordInput) wordInput.value = '';
}

// Fonction pour d√©marrer une nouvelle partie
function nouvellePartie(mot = null) {
  if (mot) {
    motSecret = mot.toUpperCase();
  } else {
    motSecret = mots[Math.floor(Math.random() * mots.length)];
  }
  motAffiche = '_'.repeat(motSecret.length);
  lettresUtilisees = [];
  erreurs = 0;
  partieEnCours = true;
  cacherMessage();
  afficherControlesJeu();
  dessinerPendu();
  afficherMot();
  afficherLettresUtilisees();
  console.log('Nouvelle partie d√©marr√©e!');
  console.log(`Mot √† deviner: ${motAffiche}`);
}

// Fonction pour proposer une lettre
function proposerLettre(lettre) {
  if (!partieEnCours) {
    console.log('D√©marrez une nouvelle partie avec nouvellePartie()');
    return;
  }

  lettre = lettre.toUpperCase();
  
  if (lettre.length !== 1 || !/[A-Z]/.test(lettre)) {
    console.log('Veuillez entrer une seule lettre');
    return;
  }

  lettresUtilisees.push(lettre);
  afficherLettresUtilisees();
  erreurs++;

  if (motSecret.includes(lettre)) {
    // Lettre trouv√©e
    let nouveauMot = '';
    for (let i = 0; i < motSecret.length; i++) {
      if (motSecret[i] === lettre) {
        nouveauMot += lettre;
      } else {
        nouveauMot += motAffiche[i];
      }
    }
    motAffiche = nouveauMot;
    afficherMot();
    console.log(`Bonne lettre! ${lettre} trouv√©e`);
    
    if (motAffiche === motSecret) {
      partieEnCours = false;
      afficherMessage('üéâ F√©licitations! Vous avez gagn√©! üéâ', 'victoire');
      console.log('F√©licitations! Vous avez gagn√©!');
    }
  } else {
    // Mauvaise lettre
    erreurs++;
    dessinerPendu();
    console.log(`Mauvaise lettre. Erreurs: ${erreurs}/${maxErreurs}`);
    
    if (erreurs >= maxErreurs) {
      partieEnCours = false;
      afficherMessage(`üò¢ Perdu! Le mot √©tait: ${motSecret}`, 'defaite');
      console.log(`Perdu! Le mot √©tait: ${motSecret}`);
    }
  }
}

// Afficher le mot
function afficherMot() {
  wordDisplay.textContent = motAffiche.split('').join(' ');
}

// Afficher les lettres utilis√©es
function afficherLettresUtilisees() {
  lettersUsedDiv.textContent = `Lettres utilis√©es: ${lettresUtilisees.join(', ')}`;
}

// Dessiner le pendu
function dessinerPendu() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = '#ffffff';
  ctx.lineWidth = 3;

  // Potence - base (toujours visible d√®s le d√©but)
  if (erreurs >= 0) {
    ctx.beginPath();
    ctx.moveTo(50, 450);
    ctx.lineTo(150, 450);
    ctx.stroke();
  }

  // Potence - poteau vertical
  if (erreurs >= 1) {
    ctx.beginPath();
    ctx.moveTo(100, 450);
    ctx.lineTo(100, 50);
    ctx.stroke();
  }

  // Potence - traverse horizontale
  if (erreurs >= 2) {
    ctx.beginPath();
    ctx.moveTo(100, 50);
    ctx.lineTo(250, 50);
    ctx.stroke();
  }

  // Potence - corde
  if (erreurs >= 3) {
    ctx.beginPath();
    ctx.moveTo(250, 50);
    ctx.lineTo(250, 80);
    ctx.stroke();
  }

  // T√™te
  if (erreurs >= 4) {
    ctx.beginPath();
    ctx.arc(250, 120, 30, 0, Math.PI * 2);
    ctx.stroke();
  }

  // Tronc
  if (erreurs >= 5) {
    ctx.beginPath();
    ctx.moveTo(250, 150);
    ctx.lineTo(250, 300);
    ctx.stroke();
  }

  // Bras gauche
  if (erreurs >= 6) {
    ctx.beginPath();
    ctx.moveTo(250, 180);
    ctx.lineTo(200, 230);
    ctx.stroke();
  }

  // Bras droit
  if (erreurs >= 7) {
    ctx.beginPath();
    ctx.moveTo(250, 180);
    ctx.lineTo(300, 230);
    ctx.stroke();
  }

  // Jambe gauche
  if (erreurs >= 8) {
    ctx.beginPath();
    ctx.moveTo(250, 300);
    ctx.lineTo(200, 380);
    ctx.stroke();
  }

  // Jambe droite
  if (erreurs >= 9) {
    ctx.beginPath();
    ctx.moveTo(250, 300);
    ctx.lineTo(300, 380);
    ctx.stroke();
  }

  // Visage triste
  if (erreurs >= maxErreurs) {
    ctx.beginPath();
    ctx.moveTo(240, 110);
    ctx.lineTo(245, 115);
    ctx.moveTo(255, 115);
    ctx.lineTo(260, 110);
    ctx.moveTo(250, 130);
    ctx.arc(250, 130, 5, 0, Math.PI);
    ctx.stroke();
  }
}

// Exposer les fonctions globalement pour le bouton et l'initialisation
window.proposerLettre = proposerLettre;
window.nouvellePartie = nouvellePartie;
window.afficherSelectionMot = afficherSelectionMot;

// Gestionnaires d'√©v√©nements pour les boutons
if (startGameBtn && wordInput) {
  startGameBtn.addEventListener('click', () => {
    const mot = wordInput.value.trim();
    if (mot && mot.length > 0) {
      nouvellePartie(mot);
    } else {
      nouvellePartie(); // Mot al√©atoire si vide
    }
  });

  wordInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      startGameBtn.click();
    }
  });

  wordInput.addEventListener('input', (e) => {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
  });
}

if (newGameBtn) {
  newGameBtn.addEventListener('click', () => {
    afficherSelectionMot();
  });
}

// Initialisation
dessinerPendu();
afficherSelectionMot(); // Afficher la s√©lection de mot au d√©marrage
console.log('=== Le Pendu ===');
console.log('');
console.log('Fonctions disponibles:');
console.log('  - nouvellePartie(mot): D√©marre une nouvelle partie');
console.log('  - proposerLettre(lettre): Propose une lettre');
console.log('');
console.log('Exemple:');
console.log('  nouvellePartie("JAVASCRIPT");');
console.log('  proposerLettre("J");
console.log('  proposerLettre("A");');
  </script>
  <script src="../shared/js/validator.js"></script>
  <script src="../shared/js/terminal.js"></script>
  <script>
    const gameJsPath = 'js/game.js';
    document.addEventListener('DOMContentLoaded', () => {
      const codeEditor = document.getElementById('code-editor');
      const executeBtn = document.getElementById('execute-btn');
      const output = document.getElementById('output');
      if (codeEditor && executeBtn && output) {
        window.terminal = new Terminal('code-editor', 'execute-btn', 'output', gameJsPath);
        
        // Ex√©cuter automatiquement le code au chargement pour que les fonctions soient disponibles
        setTimeout(() => {
          if (window.terminal && window.terminal.execute) {
            window.terminal.execute();
            // Afficher la s√©lection de mot au d√©marrage
            if (window.afficherSelectionMot) {
              window.afficherSelectionMot();
            }
          }
        }, 500);
      }

      // Gestion de l'input utilisateur pour le Pendu
      const letterInput = document.getElementById('letter-input');
      const submitLetterBtn = document.getElementById('submit-letter');
      
      if (letterInput && submitLetterBtn) {
        submitLetterBtn.addEventListener('click', () => {
          const lettre = letterInput.value.trim();
          if (lettre && window.proposerLettre) {
            window.proposerLettre(lettre);
            letterInput.value = '';
            letterInput.focus();
          }
        });

        letterInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            submitLetterBtn.click();
          }
        });

        letterInput.addEventListener('input', (e) => {
          e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
        });
      }

      const expandBtn = document.getElementById('code-expand-btn');
      const container = document.querySelector('.container');
      if (expandBtn && container) {
        expandBtn.addEventListener('click', () => {
          container.classList.toggle('code-expanded');
          const isExpanded = container.classList.contains('code-expanded');
          expandBtn.textContent = isExpanded ? 'R√©duire' : 'Agrandir';
          expandBtn.title = isExpanded ? 'R√©duire le panneau code' : 'Agrandir le panneau code';
          if (window.terminal) {
            setTimeout(() => window.terminal.resizeEditor(), 0);
          }
        });
      }
    });
  </script>
</body>
</html>
